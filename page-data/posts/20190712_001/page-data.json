{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/20190712_001/","result":{"data":{"site":{"siteMetadata":{"disqusShortname":"","subtitle":"web系の技術について紹介します","title":"kon-shou's blog","url":"https://blog.kon-shou.com"}},"markdownRemark":{"id":"4836128f-f86f-5cbe-beb4-04ccd4748dfe","html":"<ol start=\"0\">\n<li><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\">はじめに</a></li>\n<li><a href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\">システムアーキテクチャ</a></li>\n<li><a href=\"#laravelnuxtjs%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">Laravel/Nuxt.jsインストール</a></li>\n<li><a href=\"#docker%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\">Docker環境構築</a></li>\n<li><a href=\"#nginx%E8%A8%AD%E5%AE%9A\">Nginx設定</a></li>\n<li><a href=\"#typescript%E5%AF%BE%E5%BF%9C\">Typescript対応</a></li>\n<li><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E5%AE%9F%E8%A3%85\">サーバーでのモデル/ビジネスロジック実装</a></li>\n<li><a href=\"#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%81%A7%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E5%AE%9F%E8%A3%85\">フロントでのモデル/ビジネスロジック実装</a></li>\n<li><a href=\"#heroku%E8%A8%AD%E5%AE%9A\">Heroku設定</a></li>\n</ol>\n<h2 id=\"はじめに\" style=\"position:relative;\"><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\" aria-label=\"はじめに permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>はじめに</h2>\n<p>※本記事は <a href=\"https://qiita.com/kon_shou/items/8af16956325a447a2d64\">qiitaのにあげた記事</a> と同様になります。</p>\n<p>本記事では「フレームワークをインストールして、それをインターネットに公開する」という0から1までのフェーズについて、Laravel+Nuxt.jsによって「蔵書管理」システムを構築して解説したいと思います。</p>\n<p>また、実際に構築したシステムは下記になります。</p>\n<ul>\n<li>Heroku: <a href=\"https://frozen-castle-47874.herokuapp.com/\">https://frozen-castle-47874.herokuapp.com/</a></li>\n<li>Github: <a href=\"https://github.com/kon-shou/bcm-qiita-example\">https://github.com/kon-shou/bcm-qiita-example</a></li>\n</ul>\n<p><img src=\"/056f9e617c9316051f0c5f505fe9e4ef/Peek%202019-07-08%2023-45.gif\" alt=\"Peek 2019-07-08 23-45.gif\"></p>\n<h2 id=\"システムアーキテクチャ\" style=\"position:relative;\"><a href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\" aria-label=\"システムアーキテクチャ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>システムアーキテクチャ</h2>\n<p>下記の技術スタックを用います。</p>\n<p>サーバーサイド: Laravel 5.8\nフロントサイド: Nuxt.js 2.8.1 (SPA)\nWebサーバー: Nginx\n開発環境構築: docker\nデプロイ: Heroku</p>\n<p>また処理フローの図は下記になります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 592px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0165e87b70acf3f842379b3e79ac6d08/1b853/activity.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABkElEQVQoz2VS23LbIBDV/39L2pmknbQP6VM9fajzUmWccSxbsSNF1gUQIFhAXBSUum4y2VnYHeDsgcMmJP9dZd/K1c8Qptleg6Foc3vxtPrl3bwUh2yL/d1lnn7N06tder1b/lgvPieCtFV+X2zXdhyjB+cjfgSoshU6ltM/MyCaIqsPm/qQNWWOq+KYPyRxw4IhiKCuE3w4nw7STKfLxBimv6kPp8Uw5zMYUF/l+7p85piInpGmox2ygzyDz+at887GWt55P9oZrAUMhBpQ0XlPUdOSFilEOWNKKWNMnAkhGGOrzUweiX0Izs3gYN1HEqfNQLkGNSqtJXDKekw0YUNPKaPxgSewt/YjOFgrOJcStNYAEBWJyeScoCwW4g1yoJNXkpEzLoVQAIzS+ng04+il5g0GxjUXsqe4btUAQdvg/UnDKJgDPjzl5LBXg9SDFIT2HVKkF3Vh4Y348RsFVrRVfaM4UhQDbhL8uHzefS/u3zcJw+vbi8e7xf8m6co8vdymX7bp1ebPdba8WS0+vQAdezd8ZV5cVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"activity.png\"\n        title=\"activity.png\"\n        src=\"/static/0165e87b70acf3f842379b3e79ac6d08/1b853/activity.png\"\n        srcset=\"/static/0165e87b70acf3f842379b3e79ac6d08/8ff5a/activity.png 240w,\n/static/0165e87b70acf3f842379b3e79ac6d08/e85cb/activity.png 480w,\n/static/0165e87b70acf3f842379b3e79ac6d08/1b853/activity.png 592w\"\n        sizes=\"(max-width: 592px) 100vw, 592px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>「ブラウザにNuxt.jsで生成したSPAを返し、そのSPAからAPIサーバーであるLaravelにAPIリクエストを、Nginxを介して行う」というフローです。</p>\n<h2 id=\"laravelnuxtjsインストール\" style=\"position:relative;\"><a href=\"#laravelnuxtjs%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\" aria-label=\"laravelnuxtjsインストール permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Laravel/Nuxt.jsインストール</h2>\n<p>まずは<a href=\"https://readouble.com/laravel/5.8/ja/installation.html\">Laravelドキュメント</a>に従って Laravelでプロジェクトを作成します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">composer</span> create-project --prefer-dist laravel/laravel book-collection-management</code></pre></div>\n<p>作成したLaravelプロジェクトに <code class=\"language-text\">client</code> というディレクトリを新設して、そこに<a href=\"https://ja.nuxtjs.org/guide/installation\">Nuxt.jsドキュメント</a>に従って Nuxt.jsをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> create nuxt-app client ./client</code></pre></div>\n<p>コマンド実行後の選択肢は各自の要望に応じて設定してください。\n自分の場合、下記のように設定しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">? Project name client\n? Project description My fantastic Nuxt.js project\n? Author name kon-shou\n? Choose the package manager Yarn\n? Choose UI framework Buefy\n? Choose custom server framework None <span class=\"token punctuation\">(</span>Recommended<span class=\"token punctuation\">)</span>\n? Choose Nuxt.js modules Axios\n? Choose linting tools ESLint, Prettier\n? Choose <span class=\"token builtin class-name\">test</span> framework None\n? Choose rendering mode Single Page App</code></pre></div>\n<p>コマンドによって <code class=\"language-text\">./client</code> にNuxt.jsがインストールされましたが、このままだとプロジェクトの二重管理になるため、下記を行います。</p>\n<ul>\n<li>\n<p><code class=\"language-text\">./client/node_module</code> を削除</p>\n<ul>\n<li><code class=\"language-text\">rm -rdf ./client/node_modules</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">./client</code> の git 管理を解除</p>\n<ul>\n<li><code class=\"language-text\">rm -rdf ./client/.git/</code></li>\n</ul>\n</li>\n<li><code class=\"language-text\">./client</code> にある各種設定ファイルを laravel のルートに移動＆更新</li>\n</ul>\n<p>設定ファイルの更新は各自の環境に合わせて行ってください。\nただ下記の２つのファイルは特に重要なので、注記します。</p>\n<ul>\n<li>\n<p><code class=\"language-text\">.package.json</code></p>\n<ul>\n<li>npm scripts に nuxt コマンドを追記</li>\n<li>nuxt に必要なライブラリを追加</li>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/b1e3953962f917b659891a1f63f0d6d94f392a55/package.json\">修正後の.package.json</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">nuxt.config.js</code></p>\n<ul>\n<li><code class=\"language-text\">srcDir: &#39;client/&#39;</code> を追記</li>\n<li>nuxt build によって生成される <code class=\"language-text\">index.html</code> の出力先を <code class=\"language-text\">public/dist</code> に変更</li>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/b1e3953962f917b659891a1f63f0d6d94f392a55/nuxt.config.js\">修正後のnuxt.config.js</a></li>\n</ul>\n</li>\n</ul>\n<p><code class=\"language-text\">index.html</code> の出力先の変更は、ドキュメントルートである <code class=\"language-text\">public</code> 以下に配置することを意図しています。\n詳細は「Nginx設定」で解説します。</p>\n<p>その <code class=\"language-text\">index.html</code> の出力先の変更は <a href=\"https://github.com/nuxt/nuxt.js/issues/3217\">https://github.com/nuxt/nuxt.js/issues/3217</a> に従って</p>\n<div class=\"gatsby-code-title\">nuxt.config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  generate<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    dir<span class=\"token operator\">:</span> <span class=\"token string\">'public/dist'</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>を追記することで出力先を変更することができます。</p>\n<p>以上を実行した後のディレクトリ構造は下記になります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n├── .editorconfig\n├── .env\n├── .env.example\n├── .eslintrc.js\n├── .git\n├── .gitattributes\n├── .gitignore\n├── .idea\n├── .prettierrc\n├── .styleci.yml\n├── app\n├── artisan\n├── bootstrap\n├── client\n│   ├── README.md\n│   ├── assets\n│   ├── components\n│   ├── layouts\n│   ├── middleware\n│   ├── pages\n│   ├── plugins\n│   ├── static\n│   └── store\n├── composer.json\n├── composer.lock\n├── config\n├── database\n├── node_modules\n├── nuxt.config.js\n├── package.json\n├── phpunit.xml\n├── public\n├── readme.md\n├── resources\n├── routes\n├── server.php\n├── storage\n├── tests\n├── vendor\n├── webpack.mix.js\n└── yarn.lock</code></pre></div>\n<h2 id=\"docker環境構築\" style=\"position:relative;\"><a href=\"#docker%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\" aria-label=\"docker環境構築 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker環境構築</h2>\n<p>次は、DockerでWebサーバーとDBを構築して <code class=\"language-text\">docker-compose up -d</code> でアプリが立ち上がるようにします。\n追加するファイルは下記になります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n├── Dockerfile              <span class=\"token operator\">=</span><span class=\"token operator\">></span> docker-compose.yml の app.build.dockerfile で参照される\n├── docker\n│   ├── entrypoint-app.sh   <span class=\"token operator\">=</span><span class=\"token operator\">></span> docker-compose.yml の app.command で参照される\n│   ├── nginx.conf          <span class=\"token operator\">=</span><span class=\"token operator\">></span> docker-compose.yml の app.volumes で参照される\n│   └── php-fpm.conf        <span class=\"token operator\">=</span><span class=\"token operator\">></span> docker-compose.yml の app.volumes で参照される\n├── docker-compose.yml\n└── scripts\n    └── provisioning.sh     <span class=\"token operator\">=</span><span class=\"token operator\">></span> docker-compose.yml の app.command で参照される</code></pre></div>\n<p>docker-compose.ymlは下記になります。</p>\n<div class=\"gatsby-code-title\">docker-compose.yml</div>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.7</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># host/docker間で共有するデータを指定</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"${HOME}/book-management_mysql:/var/lib/mysql\"</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">TZ</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Asia/Tokyo\"</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3306:3306\"</span>\n  <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> . <span class=\"token comment\"># Dockerfileのディレクトリを指定</span>\n    <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> ubuntu\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># host/docker間で共有するデータを指定</span>\n      <span class=\"token punctuation\">-</span> .<span class=\"token punctuation\">:</span>/srv\n      <span class=\"token punctuation\">-</span> ./docker/nginx.conf<span class=\"token punctuation\">:</span>/etc/nginx/sites<span class=\"token punctuation\">-</span>enabled/bcm\n      <span class=\"token punctuation\">-</span> ./docker/php<span class=\"token punctuation\">-</span>fpm.conf<span class=\"token punctuation\">:</span>/etc/php/7.2/fpm/pool.d/bcm.conf\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> docker/entrypoint<span class=\"token punctuation\">-</span>app.sh <span class=\"token comment\"># 起動処理を設定</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mysql\n    <span class=\"token key atrule\">links</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mysql\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:8000\"</span>\n    <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /srv</code></pre></div>\n<p><code class=\"language-text\">docker-compose up -d</code> の処理の順番は下記になります。</p>\n<ol>\n<li>mysqlコンテナの起動</li>\n<li>appコンテナの起動</li>\n<li><code class=\"language-text\">Dockerfile</code> ( <code class=\"language-text\">provisioning.sh</code> ) からdocker imageの作成</li>\n<li><code class=\"language-text\">nginx.conf</code> / <code class=\"language-text\">php-fpm.conf</code> のマウント</li>\n<li><code class=\"language-text\">entrypoint-app.sh</code> の nginx / php-fpm の起動</li>\n</ol>\n<p>各ステップについて解説します。</p>\n<h4 id=\"1-mysqlコンテナの起動\" style=\"position:relative;\"><a href=\"#1-mysql%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E8%B5%B7%E5%8B%95\" aria-label=\"1 mysqlコンテナの起動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. mysqlコンテナの起動</h4>\n<p>mysqlコンテナは、mysql5.7のイメージを元にして、パスワード省略及びタイムゾーンを東京にして、ホスト/dockerの3306番ポートでアクセスを可能にしています。</p>\n<p>ホストからmysqlコンテナへのアクセスは <code class=\"language-text\">mysql -h 127.0.0.01 -uroot</code> で行えます。\nまたappコンテナからmysqlへのアクセスは <code class=\"language-text\">docker-compose exec app bash</code> でappコンテナに入り <code class=\"language-text\">mysql -h mysql -uroot</code> で行えます。</p>\n<h4 id=\"2-appコンテナの起動\" style=\"position:relative;\"><a href=\"#2-app%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E8%B5%B7%E5%8B%95\" aria-label=\"2 appコンテナの起動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. appコンテナの起動</h4>\n<p>appコンテナは、Dockerfileで必要なライブラリをインストールしたイメージを準備し、<code class=\"language-text\">/srv</code> にプロジェクトディレクトリをマウントし、ホスト/dockerの8000番ポートでアクセスを可能にしています。</p>\n<h4 id=\"21-dockerfile--provisioningsh--からdocker-imageの作成\" style=\"position:relative;\"><a href=\"#21-dockerfile--provisioningsh--%E3%81%8B%E3%82%89docker-image%E3%81%AE%E4%BD%9C%E6%88%90\" aria-label=\"21 dockerfile  provisioningsh  からdocker imageの作成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1 <code class=\"language-text\">Dockerfile</code> ( <code class=\"language-text\">provisioning.sh</code> ) からdocker imageの作成</h4>\n<p>Dockerfileは下記になります。</p>\n<div class=\"gatsby-code-title\">Dockerfile</div>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> ubuntu<span class=\"token punctuation\">:</span>18.04\n\n<span class=\"token keyword\">COPY</span> scripts/provisioning.sh /tmp/provisioning.sh\n<span class=\"token comment\"># provisioning.sh による必要ライブラリのインストール</span>\n<span class=\"token keyword\">RUN</span> /tmp/provisioning.sh\n\n<span class=\"token comment\"># nginxの初期設定を削除</span>\n<span class=\"token keyword\">RUN</span> rm /etc/nginx/sites<span class=\"token punctuation\">-</span>enabled/default\n<span class=\"token comment\"># php-fpmの初期設定を削除</span>\n<span class=\"token keyword\">RUN</span> rm /etc/php/7.2/fpm/pool.d/www.conf\n\n<span class=\"token comment\"># ubuntuユーザーを追加</span>\n<span class=\"token keyword\">RUN</span> useradd <span class=\"token punctuation\">-</span>m <span class=\"token punctuation\">-</span>s /bin/bash <span class=\"token punctuation\">-</span>u 1000 <span class=\"token punctuation\">-</span>g users ubuntu\n\n<span class=\"token keyword\">RUN</span> apt install sudo\n<span class=\"token comment\"># ubuntuでのsudoのパスワード要求をしないように</span>\n<span class=\"token keyword\">RUN</span> echo <span class=\"token string\">\"ubuntu ALL=(ALL:ALL) NOPASSWD:ALL\"</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> /etc/sudoers\n<span class=\"token keyword\">RUN</span> chown ubuntu<span class=\"token punctuation\">:</span>users /srv</code></pre></div>\n<p>Dockerfileにて <code class=\"language-text\">provisioning.sh</code> によってライブラリをインストールし、その後にユーザー関連の設定を行います。\n<code class=\"language-text\">provisioning.sh</code> は下記になります。</p>\n<div class=\"gatsby-code-title\">provisioning.sh</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">package_install</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">env</span> <span class=\"token assign-left variable\">DEBIAN_FRONTEND</span><span class=\"token operator\">=</span>noninteractive <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -y <span class=\"token variable\">$1</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">apt-get</span> update -y\n\npackage_install php-fpm\npackage_install php-mysql\npackage_install php-imagick\npackage_install php-gd\npackage_install php-curl\npackage_install php-mbstring\npackage_install php-bcmath\npackage_install php-xml\npackage_install php-zip\npackage_install php-redis\npackage_install php-intl\npackage_install nginx\npackage_install <span class=\"token function\">composer</span>\n\npackage_install mysql-client\n\npackage_install <span class=\"token function\">zip</span>\npackage_install <span class=\"token function\">unzip</span>\npackage_install jq\npackage_install <span class=\"token function\">git</span>\npackage_install jq\npackage_install <span class=\"token function\">vim</span>\npackage_install <span class=\"token function\">curl</span></code></pre></div>\n<p>もし、appコンテナで追加のライブラリが必要になったら、この <code class=\"language-text\">provisioning.sh</code> に追記し、改めてイメージをビルドするのが良いかと思います。</p>\n<h4 id=\"22-nginxconf--php-fpmconf-のマウント\" style=\"position:relative;\"><a href=\"#22-nginxconf--php-fpmconf-%E3%81%AE%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88\" aria-label=\"22 nginxconf  php fpmconf のマウント permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2 <code class=\"language-text\">nginx.conf</code> / <code class=\"language-text\">php-fpm.conf</code> のマウント</h4>\n<p>この２つの設定ファイルを配置することで、nginx/php-fpmが正しく起動できるようになります。</p>\n<p><code class=\"language-text\">php-fpm.conf</code> は下記になります。</p>\n<div class=\"gatsby-code-title\">php-fpm.conf</div>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">[bcm]\nuser = ubuntu\ngroup = users\n\nlisten = /run/php/bcm.sock\n\nlisten.owner = www-data\nlisten.group = www-data\n\npm = dynamic\npm.start_servers = 1\npm.max_children = 4\npm.min_spare_servers = 1\npm.max_spare_servers = 2\n\nrequest_terminate_timeout = 300\n\nchdir = /srv</code></pre></div>\n<p><code class=\"language-text\">php-fpm.conf</code> については <a href=\"https://www.php.net/manual/ja/install.fpm.configuration.php\">公式のマニュアル</a> でオプションを逐一調べていくのが早いかと思います。</p>\n<p>またソケットがどういうものか理解するのかは <a href=\"https://qiita.com/kuni-nakaji/items/d11219e4ad7c74ece748\">https://qiita.com/kuni-nakaji/items/d11219e4ad7c74ece748</a> の記事が非常に分かりやすく、参考にさせていただきました。</p>\n<p><code class=\"language-text\">nginx.conf</code> の詳細については次の「Nginx設定」にて解説します。</p>\n<h4 id=\"23-entrypoint-appsh-の-nginx--php-fpm-の起動\" style=\"position:relative;\"><a href=\"#23-entrypoint-appsh-%E3%81%AE-nginx--php-fpm-%E3%81%AE%E8%B5%B7%E5%8B%95\" aria-label=\"23 entrypoint appsh の nginx  php fpm の起動 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3 <code class=\"language-text\">entrypoint-app.sh</code> の nginx / php-fpm の起動</h4>\n<p><code class=\"language-text\">entrypoint-app.sh</code> は下記になります。</p>\n<div class=\"gatsby-code-title\">entrypoint-app.sh</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> php7.2-fpm start\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nginx start\n\n<span class=\"token function\">tail</span> -f /dev/null</code></pre></div>\n<p>内容としては、php-fpm/nginxの起動と、dockerが落ちないようにする処理です。</p>\n<p>これをdocker起動処理として行うことで <code class=\"language-text\">docker-compose up -d</code> だけでphp-fpm/nginxの起動をさせることができます。</p>\n<p>なお <code class=\"language-text\">tail -f /dev/null</code> の詳細については <a href=\"http://kimh.github.io/blog/jp/docker/gothas-in-writing-dockerfile-jp/#hack_to_run_container_in_the_background\">http://kimh.github.io/blog/jp/docker/gothas-in-writing-dockerfile-jp/#hack_to_run_container_in_the_background</a> のブログ記事が非常にわかりやすく、参考にさせていただきました。</p>\n<h2 id=\"nginx設定\" style=\"position:relative;\"><a href=\"#nginx%E8%A8%AD%E5%AE%9A\" aria-label=\"nginx設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nginx設定</h2>\n<p>Laravel/Nuxt.jsのインストールによって、初回アクセス時にブラウザに返却される <code class=\"language-text\">index.html</code> と、その <code class=\"language-text\">index.html</code> からのAPIアクセスを受ける <code class=\"language-text\">index.php</code> を準備できるようになりました。</p>\n<p>そこで、下記の前提条件を元にして、Nginxの設定を行いたいと思います。</p>\n<ul>\n<li>ドキュメントルートは <code class=\"language-text\">/public</code> とする</li>\n<li><code class=\"language-text\">nuxt build</code> によって生成される <code class=\"language-text\">index.html</code> 、及びその <code class=\"language-text\">index.html</code> から呼ばれる js ファイルは <code class=\"language-text\">public/dist/</code> 以下に配置する</li>\n<li>ブラウザに返された <code class=\"language-text\">index.html</code> からのAPIリクエストは <code class=\"language-text\">public/index.php</code> にルーティングする</li>\n</ul>\n<p>この前提条件を満たす <code class=\"language-text\">nginx.conf</code> は下記になります。</p>\n<div class=\"gatsby-code-title\">nginx.conf</div>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># Nginxが待ちうけるポートを指定</span>\n    <span class=\"token keyword\">listen</span> <span class=\"token number\">8000</span> default_server<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\"># ドキュメントルートを指定</span>\n    <span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>srv<span class=\"token operator\">/</span>public<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\"># {URL}/ の場合に {URL}/index.html を返す</span>\n    <span class=\"token comment\"># index index.html (デフォルト)</span>\n\n    <span class=\"token comment\"># /{任意の文字列} に前方一致するURLの場合に</span>\n    <span class=\"token comment\"># 1. /srv/public/{任意の文字列} に一致するファイルが存在すればそれを返し、存在しなければ</span>\n    <span class=\"token comment\"># 2. /dist/index.html?$query_string にリダイレクトする</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>dist<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token operator\">?</span><span class=\"token variable\">$query_string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># {任意の文字列1}/_nuxt/{任意の文字列2}に一致するURLの場合に</span>\n    <span class=\"token comment\"># 1. /srv/public/{任意の文字列1}/_nuxt/{任意の文字列2} に一致するファイルが存在すればそれを返し、存在しなければ</span>\n    <span class=\"token comment\"># 2. /dist/_nuxt/{任意の文字列2} にリダイレクトする</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> <span class=\"token operator\">/</span><span class=\"token punctuation\">(</span>_nuxt<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>$ <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>dist<span class=\"token operator\">/</span>$<span class=\"token number\">1</span><span class=\"token operator\">/</span>$<span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># {任意の文字列1}/api/{任意の文字列2}に一致するURLの場合に</span>\n    <span class=\"token comment\"># 1. /srv/public/{任意の文字列1}/api/{任意の文字列2} に一致するファイルが存在すればそれを返し、存在しなければ</span>\n    <span class=\"token comment\"># 2. /index.php?$query_string にリダイレクトする</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> <span class=\"token operator\">/</span>api<span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php<span class=\"token operator\">?</span><span class=\"token variable\">$query_string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># {任意の文字列}.phpに一致するURLの場合に</span>\n    <span class=\"token comment\"># 1. /srv/public/{任意の文字列}.php　に一致するファイルが存在すれば、そのリクエストをFastCGIに渡し、存在しなければ404を返す</span>\n    <span class=\"token comment\"># 2. /index.php?$query_string にリダイレクトする</span>\n    <span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> \\<span class=\"token punctuation\">.</span>php$ <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">=</span><span class=\"token number\">404</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">fastcgi_split_path_info</span> <span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span>\\<span class=\"token punctuation\">.</span>php<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>$<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">fastcgi_pass</span> unix<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>run<span class=\"token operator\">/</span>php<span class=\"token operator\">/</span>bcm<span class=\"token punctuation\">.</span>sock<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">fastcgi_index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">include</span> fastcgi_params<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">fastcgi_param</span> SCRIPT_FILENAME <span class=\"token variable\">$document_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>実際のアクセスでどういう処理になるかは下記になります。</p>\n<table>\n<thead>\n<tr>\n<th>順番</th>\n<th>どういうアクセスか</th>\n<th>Nginxはどういう処理をするか</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>初回アクセス</td>\n<td>URLが <code class=\"language-text\">/</code> に一致するため <code class=\"language-text\">srv/public/dist/index.html</code> をブラウザに返却する</td>\n</tr>\n<tr>\n<td>2</td>\n<td><code class=\"language-text\">index.html</code> の <code class=\"language-text\">&lt;script&gt;</code> タグに記述された <code class=\"language-text\">_nuxt/xxxx.js</code> を取得するアクセス</td>\n<td>URLが <code class=\"language-text\">/(_nuxt)/(.+)$</code> に一致するため <code class=\"language-text\">srv/public/dist/_nuxt/xxxx.js</code> をブラウザに返却する</td>\n</tr>\n<tr>\n<td>3</td>\n<td>index.htmlからの <code class=\"language-text\">/api/xxx</code> というAPIアクセス</td>\n<td>URLが <code class=\"language-text\">/api/</code> に一致するため <code class=\"language-text\">srv/public/index.php</code> を経て、Laravelで実装したレスポンスをブラウザに返却する</td>\n</tr>\n</tbody>\n</table>\n<p>この nginx.conf でルーティングがどうなるか読み解く鍵は下記かと思います。</p>\n<ul>\n<li>locationの前方一致と正規表現の優先順位の違い</li>\n<li>try_files の挙動</li>\n</ul>\n<p><a href=\"https://heartbeats.jp/hbblog/2012/04/nginx05.html\">https://heartbeats.jp/hbblog/2012/04/nginx05.html</a> の記事が非常に分かりやすく、参考にさせていただきました。</p>\n<h2 id=\"typescript対応\" style=\"position:relative;\"><a href=\"#typescript%E5%AF%BE%E5%BF%9C\" aria-label=\"typescript対応 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Typescript対応</h2>\n<p>必ずしも必要ではありませんが、Nuxt.jsの場合ではTypescriptの導入が容易であるため、ついでに導入します。</p>\n<p><a href=\"https://ja.nuxtjs.org/guide/typescript/\">公式の導入手順</a> に従っていけば導入できます。</p>\n<ul>\n<li>必要ライブラリのインストール</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @nuxt/typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> ts-node vue-class-component vue-property-decorator\n<span class=\"token function\">touch</span> tsconfig.json</code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">nuxt.config.js</code> の修正</p>\n<ul>\n<li><code class=\"language-text\">NuxtConfiguration</code> を追記</li>\n<li><code class=\"language-text\">nuxt.config.js</code> へリネーム</li>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/48707dea0741f7e479650f1dd914061f9e628338/nuxt.config.ts\">修正後のnuxt.config.ts</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">npm run dev</code> 後に <code class=\"language-text\">tsconfig.json</code> の修正</p>\n<ul>\n<li><code class=\"language-text\">&quot;exclude&quot;: [&quot;node_modules&quot;, &quot;vendor&quot;]</code> を追記</li>\n<li><code class=\"language-text\">&quot;baseUrl&quot;: &quot;./client&quot;</code> と修正</li>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/48707dea0741f7e479650f1dd914061f9e628338/tsconfig.json\">修正後のtsconfig.json</a></li>\n</ul>\n</li>\n<li>\n<p>lint対応</p>\n<ul>\n<li><code class=\"language-text\">parser</code> / <code class=\"language-text\">plugins</code> の修正</li>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/48707dea0741f7e479650f1dd914061f9e628338/.eslintrc.js\">修正後の.eslintrc.js</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">.vue</code> ファイルをTypescript対応</p>\n<ul>\n<li><a href=\"https://github.com/kon-shou/bcm-qiita-example/blob/48707dea0741f7e479650f1dd914061f9e628338/client/pages/index.vue\">修正後のindex.vue</a> ( <code class=\"language-text\">フロントでのモデル/ビジネスロジック実装</code> で新規でpage/componentを作るのでここでの修正は必要ありませんが、参考までに)</li>\n</ul>\n</li>\n</ul>\n<p>以上を実行すれば、Typescript でフロントを実装できると思います。</p>\n<h2 id=\"サーバーでのモデルビジネスロジック実装\" style=\"position:relative;\"><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A7%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E5%AE%9F%E8%A3%85\" aria-label=\"サーバーでのモデルビジネスロジック実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>サーバーでのモデル/ビジネスロジック実装</h2>\n<p>サーバで実装するのは下記の５つになります。</p>\n<ul>\n<li>Bookモデル</li>\n<li>migrationファイル</li>\n<li>Bookレポジトリ</li>\n<li>Bookコントローラ</li>\n<li>ルーティング</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n├── app\n│   ├── Eloquent\n│   │   └── Book.php    <span class=\"token operator\">=</span><span class=\"token operator\">></span> Bookモデル\n│   ├── Http\n│   │   ├── Controllers\n│   │   │   └── BookController.php  <span class=\"token operator\">=</span><span class=\"token operator\">></span> Bookコントローラ\n│   └── Repository\n│       └── BookRepository.php      <span class=\"token operator\">=</span><span class=\"token operator\">></span> Bookレポジトリ\n├── database\n│   └── migrations\n│       └── 2019_06_12_150818_create_books_table.php    <span class=\"token operator\">=</span><span class=\"token operator\">></span> migrationファイル\n└── routes\n   └── api.php  <span class=\"token operator\">=</span><span class=\"token operator\">></span> ルーティング</code></pre></div>\n<p>また、本の登録のAPIリクエストがフロントから来た場合の、フローは下記になります。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 689px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98f77a92e4623c7f70fe45a6f8b27a51/0f79a/activity_server.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABd0lEQVQoz02R227bMAyG/f7PMmxDhzUoerGrXbRr0GbB0iZx2mY+SLYsOXYsWQdKHh0PaSjd8Cf+j6QUFfGsZUlDNvHTJ7JbDsPg5PF9OXt/vn59+pLHj6iUu/t48fVtdR0/fpMHgQpZ/9ze3Ubpdp3s9/l+T3dxLzssBO8bzjjJWJocDzUqx1qU6d8qSznNnTWjwitRFFFw3lkL2qq6rVjFSibGqPVRDZcRTvccPgwhoBmmFLSxvXbGTleJpshymuesKDhCM+J7c6KMjAAQwI/mcGKeKf87Ydn7gAc8BlYFLSkhvGTIaigbPJoBJl5wbqKeU62Uhw9iS0pOC8DplHadQmPkDHSdPLW63GkAqQ8FN0p7bbwB37vL0cK0syRvdZ67ttZVYg7CGwtSakFNQ6HnoDucBvrWSuZUZRXH50Wz7UTf8ih5uWlZKrLNn1+fyetq7NnL3e/b7fLmZX6Vbheo0Hi+ml9tFrPnh++yGT8vW99t7n/8A6qL/SrseUNrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"activity_server.png\"\n        title=\"activity_server.png\"\n        src=\"/static/98f77a92e4623c7f70fe45a6f8b27a51/0f79a/activity_server.png\"\n        srcset=\"/static/98f77a92e4623c7f70fe45a6f8b27a51/8ff5a/activity_server.png 240w,\n/static/98f77a92e4623c7f70fe45a6f8b27a51/e85cb/activity_server.png 480w,\n/static/98f77a92e4623c7f70fe45a6f8b27a51/0f79a/activity_server.png 689w\"\n        sizes=\"(max-width: 689px) 100vw, 689px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>それぞれについて解説します。</p>\n<h3 id=\"bookモデル\" style=\"position:relative;\"><a href=\"#book%E3%83%A2%E3%83%87%E3%83%AB\" aria-label=\"bookモデル permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookモデル</h3>\n<div class=\"gatsby-code-title\">Book.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Eloquent</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Class Book\n * @package App\\Eloquent\n *\n * @property int $id\n * @property int $title\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>本には「ID」と「タイトル」のみ存在するものとして、Bookモデルを定義します。\n今回の場合、最低限の記述で良いかと思います</p>\n<h3 id=\"migrationファイル\" style=\"position:relative;\"><a href=\"#migration%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\" aria-label=\"migrationファイル permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>migrationファイル</h3>\n<div class=\"gatsby-code-title\">database/migrations/2019_06_12_150818_create_books_table.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Schema</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Schema<span class=\"token punctuation\">\\</span>Blueprint</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Database<span class=\"token punctuation\">\\</span>Migrations<span class=\"token punctuation\">\\</span>Migration</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CreateBooksTable</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Migration</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Run the migrations.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">up</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Schema<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'books'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>Blueprint <span class=\"token variable\">$table</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">bigIncrements</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$table</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">timestamps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Reverse the migrations.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">down</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Schema<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">dropIfExists</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'books'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>BookモデルはActiveRecordであるため、モデルのプロパティと同様のカラムを持たせています。</p>\n<h3 id=\"bookレポジトリ\" style=\"position:relative;\"><a href=\"#book%E3%83%AC%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA\" aria-label=\"bookレポジトリ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookレポジトリ</h3>\n<div class=\"gatsby-code-title\">BookRepository.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Repository</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Eloquent<span class=\"token punctuation\">\\</span>Book</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Collection</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BookRepository</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>int <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">?</span>Book\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Book<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token keyword\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Collection\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Book<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>string <span class=\"token variable\">$title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Book\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$book</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$book</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">title</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$title</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$book</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$book</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>Book <span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Book<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$book</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">id</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>コントローラで直接にデータを更新するのでなく、レポジトリでデータの更新を行い、コントローラはレポジトリのメソッドを呼び出すようにします。</p>\n<p>このようにすることで「データが持たせ方が変わった場合（例: Bookの格納をRDSでなくNoSQLに変更する）に、修正範囲を限定させることが出来る」等々のメリットがあります。</p>\n<h3 id=\"bookコントローラ\" style=\"position:relative;\"><a href=\"#book%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9\" aria-label=\"bookコントローラ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookコントローラ</h3>\n<div class=\"gatsby-code-title\">BookController.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Controllers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Repository<span class=\"token punctuation\">\\</span>BookRepository</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Dotenv<span class=\"token punctuation\">\\</span>Exception<span class=\"token punctuation\">\\</span>ValidationException</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BookController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$bookRepository</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span>BookRepository <span class=\"token variable\">$bookRepository</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">bookRepository</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$bookRepository</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token keyword\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">bookRepository</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token keyword\">list</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$title</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ValidationException</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'titleは必須です'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">bookRepository</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>int <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$book</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">bookRepository</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ValidationException</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'削除対象のbookが存在しません'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">bookRepository</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$book</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>コントローラでは、基本的にレポジトリのメソッドを呼び出すことで、Bookモデルの取得/登録/削除を行います。</p>\n<p>また、BookRepositoryはコンストラクタでDIを行うことで、コントローラとレポジトリの依存関係を薄くしています。\nこうすることで「ユニットテストでは、特別に用意したBookRepositoryを呼び出すことができ、ユニットテストの書きやすさが向上する」等々のメリットが有ります。</p>\n<h3 id=\"ルーティング\" style=\"position:relative;\"><a href=\"#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\" aria-label=\"ルーティング permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ルーティング</h3>\n<div class=\"gatsby-code-title\">api.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n\nRoute<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token single-quoted-string string\">'prefix'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'book'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$route</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$route</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'BookController@list'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$route</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'/create'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'BookController@create'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$route</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'/delete/{id}'</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'BookController@delete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>本の取得/登録/削除の３つのエンドポイントを用意し、それぞれからコントローラの対応するメソッドを呼びます。</p>\n<h3 id=\"確認\" style=\"position:relative;\"><a href=\"#%E7%A2%BA%E8%AA%8D\" aria-label=\"確認 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>確認</h3>\n<p>実際にAPIリクエストによってDBが更新されるか確認するためには以下の手順を踏みます。</p>\n<ol>\n<li><code class=\"language-text\">.env</code> の更新</li>\n<li>MySQL に database を追加</li>\n<li>migration実行</li>\n</ol>\n<p>今回の場合だと mysqlコンテナの設定に合わせて、下記のように <code class=\"language-text\">.env</code> を更新します。</p>\n<div class=\"gatsby-code-title\">.env</div>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">DB_CONNECTION=mysql\nDB_HOST=mysql\nDB_PORT=3306\nDB_DATABASE=laravel\nDB_USERNAME=root\nDB_PASSWORD=</code></pre></div>\n<p><code class=\"language-text\">.env</code> を更新した後に <code class=\"language-text\">php artisan config:cache</code> としてやることで <code class=\"language-text\">.env</code> の変更を反映させます。</p>\n<p>その後、appコンテナから mysqlに接続 ( <code class=\"language-text\">docker-compose exec app mysql -h mysql -uroot</code> ) し </p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">database</span> laravel<span class=\"token punctuation\">;</span></code></pre></div>\n<p>とすることで laravel データベースを作成します。</p>\n<p>そして <code class=\"language-text\">php artisan migrate</code> と実行することで、migrationが実行できるかと思います。</p>\n<p>以上の準備をしたあとで、</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> http://localhost:8000/api/book/create -X POST -H <span class=\"token string\">\"Content-Type: application/json\"</span> -d <span class=\"token string\">'{\"title\":\"book_test\"}'</span></code></pre></div>\n<p>と叩くことで、更新が行われ、そのレスポンスが帰ってくることが確認できるかと思います。</p>\n<h2 id=\"フロントでのモデルビジネスロジック実装\" style=\"position:relative;\"><a href=\"#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%81%A7%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E5%AE%9F%E8%A3%85\" aria-label=\"フロントでのモデルビジネスロジック実装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>フロントでのモデル/ビジネスロジック実装</h2>\n<p>フロントでは下記の6つを実装します。</p>\n<ul>\n<li>Bookモデル</li>\n<li>Bookレポジトリ</li>\n<li>plugins/dependency.ts</li>\n<li>index.d.ts</li>\n<li>Axios の proxy</li>\n<li>index.vue</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n├── client\n│   ├── domain\n│   │   └── Book\n│   │       ├── Book.ts\n│   │       └── BookRepository.ts\n│   ├── pages\n│   │   ├── index.vue\n│   ├── plugins\n│   │   └── dependency.ts\n│   └── static\n├── index.d.ts\n└── nuxt.config.js</code></pre></div>\n<p>フロントにおけるBook取得/登録のフローは下記です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 528px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5060b7c3bb8164076772ea4ac500edd3/4af8e/activity_front.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAB9ElEQVQoz21Qy27TQBTNP8MCiQ39C3bdAoK2ol1UUCEWLEBN0zRvx46TOLYnM36OX/PwzJix0xZU5ejO1dVI59xzT6/poJTSPXXmxu2n9fjCvv/ZfUrdI3s4+/1h0f9i3J1Zw7P18Nv29mb18Hn557p3oDaybBpaRhvX6Lvmg2sb7Z9sySnytsuBuxp5uuwR2CyCreWa9/7aaMlKEGd2Yk5eW9NXyDoNQey7nr9z956PwB64PkIhTQtZ0cdNGq1s87g5hiDwnMDfhcDhhCi9VAjd9KC6QTKeBCFC6PBTF5XqyKqrJ+jrhWiOIUOhY9l5nIqS0CB52vw/pKQ4T+OEEdpqCtlIfb1SXFQwwmFc5YWkXFDeklmxK9NJhWcEz/XAUjfaeLaxTFBY4YxkeZFgva1MsKr/OZK8I+/XH8f9N9PBu+XoZDZ8a929DwGCYI/2umASxdAHGqHjiYI8ByY7oZ4UijPJmWqLK0b5QfUlhEyjWKv4vh9AKPLq2M3HAlNdohggfU6ZYpYVLE6PBqZymEAABdMWal2qlo1oFJcsygWViitVK0HFS3Jd4hI5yWoeOxtB2kglEySAmWdn7qqKfYoBxQFNAhLtqhj2nt12xhbm5NzZXNuTX53T9iXe2JicL+dX5uzSNq/s6c12+GNtfjUG3/8CYcTbRySuvS4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"activity_front.png\"\n        title=\"activity_front.png\"\n        src=\"/static/5060b7c3bb8164076772ea4ac500edd3/4af8e/activity_front.png\"\n        srcset=\"/static/5060b7c3bb8164076772ea4ac500edd3/8ff5a/activity_front.png 240w,\n/static/5060b7c3bb8164076772ea4ac500edd3/e85cb/activity_front.png 480w,\n/static/5060b7c3bb8164076772ea4ac500edd3/4af8e/activity_front.png 528w\"\n        sizes=\"(max-width: 528px) 100vw, 528px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>なおフロントにレポジトリ層を持たせる設計については、拙作ではありますが <a href=\"https://speakerdeck.com/kon_shou/shi-yun-yong-niokerularaveltonuxtdefalserepositoryfalsereiyafen-ge-falsehua\">こちらのスライド</a> にて詳細を解説していますので、ご参考ください。</p>\n<h3 id=\"bookモデル-1\" style=\"position:relative;\"><a href=\"#book%E3%83%A2%E3%83%87%E3%83%AB-1\" aria-label=\"bookモデル 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookモデル</h3>\n<div class=\"gatsby-code-title\">Book.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Book</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">protected</span> properties<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">get</span> <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">,</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">get</span> <span class=\"token function\">title</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">,</span> <span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>サーバーと同様のBookモデルを定義します。\nこれによって <code class=\"language-text\">new Book({id: xxx, titile: yyy})</code> という形式でモデルを作ることができ、このモデルで型宣言を行うことができるようになります。</p>\n<h3 id=\"bookレポジトリ-1\" style=\"position:relative;\"><a href=\"#book%E3%83%AC%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA-1\" aria-label=\"bookレポジトリ 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bookレポジトリ</h3>\n<div class=\"gatsby-code-title\">BookRepository.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AxiosInstance <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"token keyword\">import</span> Book <span class=\"token keyword\">from</span> <span class=\"token string\">'~/domain/Book/Book'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BookRepository</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> axios<span class=\"token operator\">:</span> AxiosInstance\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>axios<span class=\"token operator\">:</span> AxiosInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>axios <span class=\"token operator\">=</span> axios\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">listBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Book<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/book/'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> bookData <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span>bookData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">createBook</span><span class=\"token punctuation\">(</span>title<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Book<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/book/create'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token operator\">:</span> title\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Book</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">deleteBook</span><span class=\"token punctuation\">(</span>book<span class=\"token operator\">:</span> Book<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">delete</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/book/delete/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>book<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>こちらもサーバーと同様にBookRepositoryを実装します。\nメリットについてもサーバーと同様です。</p>\n<p>コンストラクタで axiso を注入をしていますが、これは後述する <code class=\"language-text\">plugins/dependency.ts</code> にて注入を行っています。\n注入によって axios の context を維持しつつAPIリクエストを投げられるようになります。</p>\n<h3 id=\"pluginsdependencyts\" style=\"position:relative;\"><a href=\"#pluginsdependencyts\" aria-label=\"pluginsdependencyts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>plugins/dependency.ts</h3>\n<div class=\"gatsby-code-title\">dependency.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BookRepository <span class=\"token keyword\">from</span> <span class=\"token string\">'~/domain/Book/BookRepository'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> inject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> bookRepository <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BookRepository</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>$axios<span class=\"token punctuation\">)</span>\n\n  <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bookRepository'</span><span class=\"token punctuation\">,</span> bookRepository<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>BookRepositoryに <code class=\"language-text\">context.$axios</code> を渡し、生成された <code class=\"language-text\">bookRepository</code> を <code class=\"language-text\">$bookRepository</code> として Vue インスタンス内で呼び出せるように登録しています。</p>\n<p>このプラグインを <code class=\"language-text\">nuxt.config.ts</code> にて呼び出します。</p>\n<div class=\"gatsby-code-title\">nuxt.config.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'~/plugins/dependency'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>なお、NuxtにおけるInjectionについては<a href=\"https://ja.nuxtjs.org/guide/plugins/\">公式ドキュメント</a> と <a href=\"https://tech.cydas.com/entry/nuxt-inject\">https://tech.cydas.com/entry/nuxt-inject</a> の記事が非常にわかりやすく、参考にさせていただきました。</p>\n<h3 id=\"indexdts\" style=\"position:relative;\"><a href=\"#indexdts\" aria-label=\"indexdts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.d.ts</h3>\n<p><code class=\"language-text\">dependency.ts</code> にて <code class=\"language-text\">$bookRepository</code> を登録しましたが、このままだと Typescript のチェックでエラーが出るので型定義ファイルに <code class=\"language-text\">$bookRepository</code> に追加します。</p>\n<div class=\"gatsby-code-title\">index.d.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> BookRepository <span class=\"token keyword\">from</span> <span class=\"token string\">'~/domain/Book/BookRepository'</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'vue/types/vue'</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Vue</span> <span class=\"token punctuation\">{</span>\n    $bookRepository<span class=\"token operator\">:</span> BookRepository\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"axios-の-proxy\" style=\"position:relative;\"><a href=\"#axios-%E3%81%AE-proxy\" aria-label=\"axios の proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Axios の proxy</h3>\n<p>BookRepository にて axios を利用していますが、このままだと 例えば本の登録では、Nginxがリッスンしている <code class=\"language-text\">http://localhost:8000/api/book/create</code> でなく<code class=\"language-text\">http://localhost:3000/book/create</code> に対してリクエストをしてしまうので、下記の修正を行います。</p>\n<ul>\n<li>axios.baseURL の指定</li>\n</ul>\n<p>下記を追記することで、urlのプレフィックスとして <code class=\"language-text\">/api</code> を付与します。</p>\n<div class=\"gatsby-code-title\">nuxt.config.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">  axios<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    baseURL<span class=\"token operator\">:</span> <span class=\"token string\">'/api'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">@nuxtjs/proxy</code> の利用</li>\n</ul>\n<p>nuxt の <a href=\"https://github.com/nuxt-community/proxy-module\">proxy-module</a> を利用して、axiosからのリクエストを proxy します。</p>\n<p>今回の場合は <code class=\"language-text\">.env</code> にAPIサーバーのURLを追記して、それを <code class=\"language-text\">nuxt.config.ts</code> に呼び出すことにします。</p>\n<p>まず <code class=\"language-text\">.env</code> に下記を追加して</p>\n<div class=\"gatsby-code-title\">.env</div>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">API_BASE_URL=http://localhost:8000/api</code></pre></div>\n<p>次に <code class=\"language-text\">nuxt.config.ts</code> を修正します。</p>\n<div class=\"gatsby-code-title\">nuxt.config.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> NuxtConfiguration <span class=\"token keyword\">from</span> <span class=\"token string\">'@nuxt/config'</span>\n\n<span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> config<span class=\"token operator\">:</span> NuxtConfiguration <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n  modules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// Doc: https://buefy.github.io/#/documentation</span>\n    <span class=\"token string\">'nuxt-buefy'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Doc: https://axios.nuxtjs.org/usage</span>\n    <span class=\"token string\">'@nuxtjs/axios'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'@nuxtjs/eslint-module'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'@nuxtjs/proxy'</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_BASE_URL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  config<span class=\"token punctuation\">.</span>proxy <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">API_BASE_URL</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> config</code></pre></div>\n<p>これによって axios のリクエストが <code class=\"language-text\">http://localhost:8000/api</code> に行われるようになります。</p>\n<h3 id=\"indexvue\" style=\"position:relative;\"><a href=\"#indexvue\" aria-label=\"indexvue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.vue</h3>\n<p>最後に index.vue の修正を行います。</p>\n<p>index.vue では主に下記の3つの処理を行います。</p>\n<ul>\n<li>asynData() で <code class=\"language-text\">$bookRepository.listBooks()</code> を実行し、本の一覧を取得</li>\n<li>登録ボタンクリックで <code class=\"language-text\">$bookRepository.createBook(this.title)</code> を実行し、本を登録し、その後に一覧を再取得</li>\n<li>削除ボタンクリックで <code class=\"language-text\">$bookRepository.deleteBook(book)</code> を実行し、本を削除し、その後に一覧を再取得</li>\n</ul>\n<div class=\"gatsby-code-title\">index.vue</div>\n<div class=\"gatsby-highlight\" data-language=\"vue\"><pre class=\"language-vue\"><code class=\"language-vue\">&lt;template&gt;\n  &lt;section&gt;\n    &lt;table class=&quot;table&quot;&gt;\n      &lt;tr&gt;\n        &lt;th&gt;ID&lt;/th&gt;\n        &lt;th&gt;タイトル&lt;/th&gt;\n      &lt;/tr&gt;\n      &lt;tr v-for=&quot;book in books&quot; :key=&quot;book.id&quot;&gt;\n        &lt;td&gt;{{ book.id }}&lt;/td&gt;\n        &lt;td&gt;{{ book.title }}&lt;/td&gt;\n        &lt;td&gt;\n          &lt;button\n            type=&quot;button&quot;\n            class=&quot;button is-primary&quot;\n            @click.prevent=&quot;deleteBook(book)&quot;\n          &gt;\n            削除する\n          &lt;/button&gt;\n        &lt;/td&gt;\n      &lt;/tr&gt;\n    &lt;/table&gt;\n\n    &lt;section class=&quot;modal-card-body&quot;&gt;\n      &lt;b-field label=&quot;本のタイトル&quot;&gt;\n        &lt;b-input v-model=&quot;title&quot; type=&quot;input&quot; placeholder=&quot;タイトル&quot; /&gt;\n      &lt;/b-field&gt;\n      &lt;button\n        type=&quot;button&quot;\n        class=&quot;button is-primary&quot;\n        @click.prevent=&quot;createBook()&quot;\n      &gt;\n        登録する\n      &lt;/button&gt;\n    &lt;/section&gt;\n\n    &lt;p v-if=&quot;error&quot;&gt;{{ error }}&lt;/p&gt;\n  &lt;/section&gt;\n&lt;/template&gt;\n\n&lt;script lang=&quot;ts&quot;&gt;\nimport { Component, Vue } from &#39;vue-property-decorator&#39;\nimport Book from &#39;~/domain/Book/Book&#39;\n\n@Component({\n  async asyncData({ app }) {\n    const books = await app.$bookRepository.listBooks()\n\n    return {\n      books\n    }\n  }\n})\nexport default class extends Vue {\n  private books\n\n  private title = &#39;&#39;\n  private error = &#39;&#39;\n\n  async createBook() {\n    try {\n      await this.$bookRepository.createBook(this.title)\n\n      this.books = await this.$bookRepository.listBooks()\n      this.title = &#39;&#39;\n    } catch (e) {\n      this.error = e\n    }\n  }\n\n  async deleteBook(book: Book) {\n    try {\n      await this.$bookRepository.deleteBook(book)\n\n      this.books = await this.$bookRepository.listBooks()\n    } catch (e) {\n      this.error = e\n    }\n  }\n}\n&lt;/script&gt;</code></pre></div>\n<h3 id=\"確認-1\" style=\"position:relative;\"><a href=\"#%E7%A2%BA%E8%AA%8D-1\" aria-label=\"確認 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>確認</h3>\n<p>以上のフロント/サーバーでの実装が完了した後に</p>\n<ul>\n<li>docker-compose up -d</li>\n<li>npm run dev</li>\n</ul>\n<p>を実行すれば、 <code class=\"language-text\">http://localhost:3000/</code> にてシステムが動作してることが確認できるかと思います。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d978bfd1c9e04250cd182f3466b3e7f/dd45a/Screenshot%20from%202019-07-09%2000-22-41.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACvUlEQVQ4y7WS208TQRTGNxpNTHzSJ/8Iffc/UBHjpSVGQQQKSEx8NiZgfDFeQgyJr5gYHjQSxYaLGGMsrW1qq8i1N6iA2629bKG07G7Zy3ye3VZCELVRPMkvZ+Zk5puZ8w1nO1Oj19lqYbfVMns5o852Cq0tDXA016O9tZHG9Whuuog2xyU0X74AB83t507i7OnjxAlzPWuor8ON88cY5/88AV8wyAJePwL+ILzvfYiEo0gmBCS+8ojPx/HO5YNrzA+v9yPcnoCVx9wfiCDVfXDT2OMJMM+YFxzAGKxgTMc6ZR0GNCiQsGYUKctYWV9F0aA5k6mqIK8WUdALSEtpmgNZOc9SUo52MsaFnBlEBnMID4qYGviGWWcaE8+T8D6eh6s3DF9fHOP9AkLDokWYmBxIYcbJY/xZiGoyPr0Q4H/CQ4xJ4O7tjuDhoRge7I/gDhfGbS5k0b2Xavvm0L0nhvu7IujkpitMoYtyFzeLm7S+k5vELRpfp9pQxwK40StJvL2WwZurKYy2JTHiEDDSIuBVWyW3J/G6I4mhRmELiQoChpsEvLQnMP00a/bQQF7JQjJWrf79S2jkAaeWNGQzIvLLq1grSlAlHYJfBu+WsOSSIGU0ajWDoRLaryFHocgKOE1VwfMJZNIZpMUUVpYU9B1dRO/hOHoORjE/VLBON3RmCW8XP+qKQoJbF+magVy0hMyMYlEq6BubfseGIC2FpmnQdfp/hmFu3eYK1fWwIggsLiwiGokhS8/OicskzKybmpiHVIMZpVKp/GQdKnldhlpM/apeyMR8namzIZjnSxCjMrKEskKumrJVilk/oJItQfM79NfweHTkC3oOxOC/K5Zd1dgfjdjWFHOS8EqIjxQx5yxgeW69Klc3C21x+df/qtr46YaMPq1RgRmbTmV/IYgdiP8maLm8k4KyLOM7LIsBcxjV35wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot from 2019-07-09 00-22-41.png\"\n        title=\"Screenshot from 2019-07-09 00-22-41.png\"\n        src=\"/static/3d978bfd1c9e04250cd182f3466b3e7f/dd45a/Screenshot%20from%202019-07-09%2000-22-41.png\"\n        srcset=\"/static/3d978bfd1c9e04250cd182f3466b3e7f/8ff5a/Screenshot%20from%202019-07-09%2000-22-41.png 240w,\n/static/3d978bfd1c9e04250cd182f3466b3e7f/e85cb/Screenshot%20from%202019-07-09%2000-22-41.png 480w,\n/static/3d978bfd1c9e04250cd182f3466b3e7f/dd45a/Screenshot%20from%202019-07-09%2000-22-41.png 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"heroku設定\" style=\"position:relative;\"><a href=\"#heroku%E8%A8%AD%E5%AE%9A\" aria-label=\"heroku設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Heroku設定</h2>\n<p>herokuの設定としては、下記の５つを実装します</p>\n<ul>\n<li><code class=\"language-text\">infra/nginx/nginx.conf</code> / <code class=\"language-text\">Procfile</code> の追加</li>\n<li>heroku buildpack の追加</li>\n<li>Clear DB の設定</li>\n<li><code class=\"language-text\">app/Providers/AppServiceProvider.php</code> の修正</li>\n<li>環境変数の設定</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>\n├── Procfile\n├── app\n│   └── Providers\n│       └── AppServiceProvider.php\n└── infra\n    └── heroku\n        └── nginx.conf</code></pre></div>\n<p>なお <code class=\"language-text\">heroku create</code> によるherokuとの連携は完了してる前提です。</p>\n<h3 id=\"infranginxnginxconf--procfile-の追加\" style=\"position:relative;\"><a href=\"#infranginxnginxconf--procfile-%E3%81%AE%E8%BF%BD%E5%8A%A0\" aria-label=\"infranginxnginxconf  procfile の追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><code class=\"language-text\">infra/nginx/nginx.conf</code> / <code class=\"language-text\">Procfile</code> の追加</h3>\n<p>herokuで Nginx を使うために <code class=\"language-text\">infra/nginx/nginx.conf</code> を <a href=\"https://devcenter.heroku.com/articles/custom-php-settings#using-a-custom-application-level-nginx-configuration\">herokuの公式ドキュメント</a> に従って、新しく作成します。</p>\n<ul>\n<li>location ディレクティブのみを使う</li>\n<li><code class=\"language-text\">fastcgi_pass</code> は <code class=\"language-text\">heroku-fcgi</code> を指定する</li>\n</ul>\n<p>という点を反映させると、下記のようになると思います。</p>\n<div class=\"gatsby-code-title\">nginx.conf</div>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>public<span class=\"token operator\">/</span>dist<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token operator\">?</span><span class=\"token variable\">$query_string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> <span class=\"token operator\">/</span>_nuxt<span class=\"token operator\">/</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>$ <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>public<span class=\"token operator\">/</span>dist<span class=\"token operator\">/</span>_nuxt<span class=\"token operator\">/</span>$<span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> <span class=\"token operator\">/</span>api<span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>public<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php<span class=\"token operator\">?</span><span class=\"token variable\">$query_string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> \\<span class=\"token punctuation\">.</span>php$ <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span>public<span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php <span class=\"token operator\">=</span><span class=\"token number\">404</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">fastcgi_split_path_info</span> <span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span>\\<span class=\"token punctuation\">.</span>php<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>$<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">fastcgi_pass</span> heroku<span class=\"token operator\">-</span>fcgi<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">fastcgi_index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>php<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">fastcgi_param</span> SCRIPT_FILENAME <span class=\"token variable\">$document_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">include</span> fastcgi_params<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>また、上記の <code class=\"language-text\">nginx.conf</code> を利用するように、下記の <code class=\"language-text\">Procfile</code> を追加します。</p>\n<div class=\"gatsby-code-title\">Procfile</div>\n<div class=\"gatsby-highlight\" data-language=\"procfile\"><pre class=\"language-procfile\"><code class=\"language-procfile\">web: vendor/bin/heroku-php-nginx -C infra/heroku/nginx.conf</code></pre></div>\n<p>Procfileの役割については <a href=\"https://devcenter.heroku.com/articles/procfile\">公式ドキュメント</a> に記載が有ります。</p>\n<h3 id=\"heroku-buildpack-の追加\" style=\"position:relative;\"><a href=\"#heroku-buildpack-%E3%81%AE%E8%BF%BD%E5%8A%A0\" aria-label=\"heroku buildpack の追加 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>heroku buildpack の追加</h3>\n<p>heroku にデプロイは <code class=\"language-text\">git push heroku master</code> で行いますが、その push 後の起動処理を行うためにビルドパックを追加します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">heroku buildpacks:add heroku/nodejs\nheroku buildpacks:add heroku/php</code></pre></div>\n<p>これによって、フロントのビルドや必要ライブラリのインストールを実行されます。</p>\n<h3 id=\"clear-db-の設定\" style=\"position:relative;\"><a href=\"#clear-db-%E3%81%AE%E8%A8%AD%E5%AE%9A\" aria-label=\"clear db の設定 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clear DB の設定</h3>\n<p>heroku でも mysql を利用するために <a href=\"https://elements.heroku.com/addons/cleardb\">ClearDB</a> を利用したいと思います。</p>\n<p>まず下記コマンドを叩きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">heroku addons:add cleardb</code></pre></div>\n<p>すると <code class=\"language-text\">CLEARDB_DATABASE_URL</code> という変数が <code class=\"language-text\">heroku config</code> に設定されると思います。\nこの <code class=\"language-text\">CLEARDB_DATABASE_URL</code> は下記のように読み解けます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql://<span class=\"token punctuation\">{</span>DB_USERNAME<span class=\"token punctuation\">}</span>:<span class=\"token punctuation\">{</span>DB_PASSWORD<span class=\"token punctuation\">}</span>@<span class=\"token punctuation\">{</span>DB_HOST<span class=\"token punctuation\">}</span>/<span class=\"token punctuation\">{</span>DB_DATABASE<span class=\"token punctuation\">}</span>?reconnect<span class=\"token operator\">=</span>true</code></pre></div>\n<p>そこで下記のようにHerokuの環境変数にセットすることで、laravelからDBアクセスを行えるようになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">heroku config:set <span class=\"token assign-left variable\">DB_HOST</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>DB_HOST<span class=\"token punctuation\">}</span>\nheroku config:set <span class=\"token assign-left variable\">DB_DATABASE</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>DB_DATABASE<span class=\"token punctuation\">}</span>\nheroku config:set <span class=\"token assign-left variable\">DB_USERNAME</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>DB_USERNAME<span class=\"token punctuation\">}</span>\nheroku config:set <span class=\"token assign-left variable\">DB_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>DB_PASSWORD<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上で、本来ならば Mysql接続が完了してほしいところですが、laravel の想定してる Mysql のバージョンとHerokuのMysql のバージョンが異なっているためか、migration 実行時にエラーが発生します。</p>\n<p>そのため、下記のように修正を行います。</p>\n<div class=\"gatsby-code-title\">AppServiceProvider.php</div>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">App<span class=\"token punctuation\">\\</span>Providers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>Facades<span class=\"token punctuation\">\\</span>Schema</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Illuminate<span class=\"token punctuation\">\\</span>Support<span class=\"token punctuation\">\\</span>ServiceProvider</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">AppServiceProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceProvider</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Register any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * Bootstrap any application services.\n     *\n     * @return void\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">boot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        Schema<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">defaultStringLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>こちらの対応は <a href=\"https://qiita.com/beer_geek/items/6e4264db142745ea666f\">https://qiita.com/beer_geek/items/6e4264db142745ea666f</a> を参考にさせていただきました。</p>\n<h3 id=\"確認-2\" style=\"position:relative;\"><a href=\"#%E7%A2%BA%E8%AA%8D-2\" aria-label=\"確認 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>確認</h3>\n<p>以上の準備が完了した後に</p>\n<ol>\n<li><code class=\"language-text\">git push heroku master</code></li>\n<li><code class=\"language-text\">heroku run php artisan migrate</code></li>\n</ol>\n<p>を実行すれば、実際にブラウザで動作していることが確認できると思います。</p>\n<h2 id=\"終わりに\" style=\"position:relative;\"><a href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\" aria-label=\"終わりに permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>終わりに</h2>\n<p>以上で、Lareavel+Nuxt.jsで作ったwebアプリをHerokuにデプロイさせることが出来ました。</p>\n<p>記事の内容で誤ってる点や追記が必要な点も多いと思いますが、その際にはコメントや編集リクエストでご指摘いただければと思います。</p>\n<p>この記事がWeb開発における0から1へのフェーズに学習する方の参考になれば幸いです。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://readouble.com/laravel/5.8/ja/\">https://readouble.com/laravel/5.8/ja/</a></li>\n<li><a href=\"https://ja.nuxtjs.org/\">https://ja.nuxtjs.org/</a></li>\n<li><a href=\"https://www.php.net/manual/ja/install.fpm.configuration.php\">https://www.php.net/manual/ja/install.fpm.configuration.php</a></li>\n<li><a href=\"https://github.com/nuxt/nuxt.js/issues/3217\">https://github.com/nuxt/nuxt.js/issues/3217</a></li>\n<li><a href=\"https://heartbeats.jp/hbblog/2012/04/nginx05.html\">https://heartbeats.jp/hbblog/2012/04/nginx05.html</a></li>\n<li><a href=\"http://kimh.github.io/blog/jp/docker/gothas-in-writing-dockerfile-jp/#hack_to_run_container_in_the_background\">http://kimh.github.io/blog/jp/docker/gothas-in-writing-dockerfile-jp/#hack_to_run_container_in_the_background</a></li>\n<li><a href=\"https://tech.cydas.com/entry/nuxt-inject\">https://tech.cydas.com/entry/nuxt-inject</a></li>\n<li><a href=\"https://devcenter.heroku.com/articles/custom-php-settings#using-a-custom-application-level-nginx-configuration\">https://devcenter.heroku.com/articles/custom-php-settings#using-a-custom-application-level-nginx-configuration</a></li>\n<li><a href=\"https://qiita.com/kuni-nakaji/items/d11219e4ad7c74ece748\">https://qiita.com/kuni-nakaji/items/d11219e4ad7c74ece748</a></li>\n<li><a href=\"https://qiita.com/beer_geek/items/6e4264db142745ea666f\">https://qiita.com/beer_geek/items/6e4264db142745ea666f</a></li>\n<li><div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.19718309859155%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe id=\"talk_frame_488505\" src=\"//speakerdeck.com/player/ec7b57f9138444a1b66600dee1d0d618\" style=\"border:0; padding:0; margin:0; background:transparent; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" frameborder=\"0\" allowtransparency=\"true\" allowfullscreen=\"allowfullscreen\" mozallowfullscreen=\"true\" webkitallowfullscreen=\"true\"></iframe> </div></li>\n</ul>","fields":{"slug":"/posts/20190712/","tagSlugs":["/tag/laravel/","/tag/nuxt-js/","/tag/docker/","/tag/heroku/"]},"frontmatter":{"date":"2019-07-12","tags":["Laravel","Nuxt.js","Docker","Heroku"],"title":"Laravel+Nuxt.jsでDocker開発環境構築からHerokuデプロイまで","description":"Laravel+Nuxt.jsで「Docker開発環境構築からHerokuデプロイまで」という0→1のフェーズをまとめました。","image":{"children":[{"__typename":"ImageSharp","fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACvUlEQVQ4y7WS208TQRTGNxpNTHzSJ/8Iffc/UBHjpSVGQQQKSEx8NiZgfDFeQgyJr5gYHjQSxYaLGGMsrW1qq8i1N6iA2629bKG07G7Zy3ye3VZCELVRPMkvZ+Zk5puZ8w1nO1Oj19lqYbfVMns5o852Cq0tDXA016O9tZHG9Whuuog2xyU0X74AB83t507i7OnjxAlzPWuor8ON88cY5/88AV8wyAJePwL+ILzvfYiEo0gmBCS+8ojPx/HO5YNrzA+v9yPcnoCVx9wfiCDVfXDT2OMJMM+YFxzAGKxgTMc6ZR0GNCiQsGYUKctYWV9F0aA5k6mqIK8WUdALSEtpmgNZOc9SUo52MsaFnBlEBnMID4qYGviGWWcaE8+T8D6eh6s3DF9fHOP9AkLDokWYmBxIYcbJY/xZiGoyPr0Q4H/CQ4xJ4O7tjuDhoRge7I/gDhfGbS5k0b2Xavvm0L0nhvu7IujkpitMoYtyFzeLm7S+k5vELRpfp9pQxwK40StJvL2WwZurKYy2JTHiEDDSIuBVWyW3J/G6I4mhRmELiQoChpsEvLQnMP00a/bQQF7JQjJWrf79S2jkAaeWNGQzIvLLq1grSlAlHYJfBu+WsOSSIGU0ajWDoRLaryFHocgKOE1VwfMJZNIZpMUUVpYU9B1dRO/hOHoORjE/VLBON3RmCW8XP+qKQoJbF+magVy0hMyMYlEq6BubfseGIC2FpmnQdfp/hmFu3eYK1fWwIggsLiwiGokhS8/OicskzKybmpiHVIMZpVKp/GQdKnldhlpM/apeyMR8namzIZjnSxCjMrKEskKumrJVilk/oJItQfM79NfweHTkC3oOxOC/K5Zd1dgfjdjWFHOS8EqIjxQx5yxgeW69Klc3C21x+df/qtr46YaMPq1RgRmbTmV/IYgdiP8maLm8k4KyLOM7LIsBcxjV35wAAAAASUVORK5CYII=","aspectRatio":0.9478672985781991,"src":"/static/3d978bfd1c9e04250cd182f3466b3e7f/1c1a5/Screenshot%20from%202019-07-09%2000-22-41.png","srcSet":"/static/3d978bfd1c9e04250cd182f3466b3e7f/69585/Screenshot%20from%202019-07-09%2000-22-41.png 200w,\n/static/3d978bfd1c9e04250cd182f3466b3e7f/497c6/Screenshot%20from%202019-07-09%2000-22-41.png 400w,\n/static/3d978bfd1c9e04250cd182f3466b3e7f/1c1a5/Screenshot%20from%202019-07-09%2000-22-41.png 550w","sizes":"(max-width: 550px) 100vw, 550px"}}],"publicURL":"/static/3d978bfd1c9e04250cd182f3466b3e7f/Screenshot from 2019-07-09 00-22-41.png"}}}},"pageContext":{"slug":"/posts/20190712/"}},"staticQueryHashes":["1155056556","1525128060","783282510"]}