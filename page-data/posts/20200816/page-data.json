{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/20200816/","result":{"data":{"site":{"siteMetadata":{"disqusShortname":"","subtitle":"web系の技術について紹介します","title":"kon-shou's blog","url":"https://blog.kon-shou.com"}},"markdownRemark":{"id":"2df2a1b4-3ef4-535f-8b4b-acb34df5f4e7","html":"<h1 id=\"作ったもの\" style=\"position:relative;\"><a href=\"#%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%82%E3%81%AE\" aria-label=\"作ったもの permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>作ったもの</h1>\n<p>クリップボードから Json を読み込んで、こんな風にに表示してくれる <code class=\"language-text\">fcj</code> というコマンドを作りました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 509px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/469969a37a4e7abecebd195529309de3/71554/formatted.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAAsSAAALEgHS3X78AAABu0lEQVQ4y52TW2sTQRiG57Bz3jlsdkiz3W5z0CRYm5SmqBfeWyloUGwIFAIF8UK88cq/YC2iIP2/zi5VNBbc3Zf3Ytidh5nve78Br188O18+3/Kbl6eb1fLD2837y4t3m/VqeXpe+vbX+tXZ5mL1aX0GPvZH173dK2uvnPvtz9Z+n0xvHj2+OVn8mB99e3h43dv5c8+XpPPVObDbTTqCcAC2DWFlxAAUYfHPBgYAcF0LCPhLsDK46+OWMSZpPu0WY2Mc5ZjFGCJQV1EUidgkvT6Xhmuc7jMIa8NMSJ8PpUkYI7AB90tKm9h6EVtCCEaoMc+UzcbH3b2RkAor1ZCGKBsdZoMD7lx8rx8R1AzOJ8f5/SPG2eCJ9vuyPogYY1xZqROEEJUoYrU7Z4yhlIJ2CsdKm8adTMg4xN6Yp1xNxgc+La9dVdIkcIyx3xNc3znW/xOCkAmt09z4TCpVFIXRum6/y8ql7s+e7gweOOdm8/lwOGiUNPbFNBvNEt9TQjnlUP1RDT2ntGw74ZJTZqSuWz/nXAjRJufABfb28iGkKqdaz5OVR/KW48U5A23CreS9b1lt0GJxEvrcjv0JoTQ0R/Gw1CgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"formatted.png\"\n        title=\"formatted.png\"\n        src=\"/static/469969a37a4e7abecebd195529309de3/71554/formatted.png\"\n        srcset=\"/static/469969a37a4e7abecebd195529309de3/8ff5a/formatted.png 240w,\n/static/469969a37a4e7abecebd195529309de3/e85cb/formatted.png 480w,\n/static/469969a37a4e7abecebd195529309de3/71554/formatted.png 509w\"\n        sizes=\"(max-width: 509px) 100vw, 509px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://github.com/kon-shou/fcj\">https://github.com/kon-shou/fcj</a></p>\n<p><code class=\"language-text\">npm install -g fcj</code> でインストールできます。</p>\n<h1 id=\"何ができるの？\" style=\"position:relative;\"><a href=\"#%E4%BD%95%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%AE%EF%BC%9F\" aria-label=\"何ができるの？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>何ができるの？</h1>\n<p>クリップボードを勝手に読み込んで</p>\n<ul>\n<li>\n<p>Json が保存されてたら…</p>\n<ul>\n<li>整形＆色付きでターミナルに表示</li>\n<li><code class=\"language-text\">~/.fcj/formatted.Json</code> に結果を保存</li>\n</ul>\n</li>\n<li>\n<p>Json 以外が保存されてたら…</p>\n<ul>\n<li>デコードしてターミナルに表示</li>\n<li><code class=\"language-text\">~/.fcj/formatted.text</code> に結果を保存</li>\n</ul>\n</li>\n</ul>\n<p>みたいなことができます。</p>\n<h1 id=\"どうして作ったの？\" style=\"position:relative;\"><a href=\"#%E3%81%A9%E3%81%86%E3%81%97%E3%81%A6%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%AE%EF%BC%9F\" aria-label=\"どうして作ったの？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>どうして作ったの？</h1>\n<blockquote class=\"twitter-tweet\">\n  <p lang=\"ja\" dir=\"ltr\">\n    よく色んな人に JSON\n    パーサ書くのをオススメしてるけど、書き始めた皆さんだいたい同じ箇所で引っ掛かったり間違えたりするので、その度に「そこです、そこが後から効いてくるんです(僕もそこ間違った)」と心の中で思ってる。\n  </p>\n  &mdash; mattn (@mattn_jp)\n  <a\n    href=\"https://twitter.com/mattn_jp/status/1293542617225900032?ref_src=twsrc%5Etfw\"\n    >August 12, 2020</a\n  >\n</blockquote>\n<p>このツイートを見て、「息抜きがてらにやってみるか〜」と思ったことがきっかけです。</p>\n<p>あとオペとかしてると、ワンラインになってたり、エンコードされてたりする Json に良く遭遇するじゃないですか？</p>\n<p>今まで、自分の場合だと</p>\n<ol>\n<li>Jsonをコピー</li>\n<li>ターミナルで <code class=\"language-text\">{Jsonをペースト} | jq .</code></li>\n<li>結果をコピーして、別ファイルにペーストして、Intellijで開く。</li>\n</ol>\n<p>みたいなフローだったんですが、コピーとペーストがめんどくさいなぁと思ってました。</p>\n<p><code class=\"language-text\">fcj</code> を使うと</p>\n<ol>\n<li>Jsonをコピー</li>\n<li>ターミナルで <code class=\"language-text\">fcj</code> と叩く</li>\n<li>あらかじめ作成しといたシンボリックを intellij で開く</li>\n</ol>\n<p>みたいなフローになりました。</p>\n<p>逐一、コピー＆ペーストをしなくていいのがちょっと楽。という感じです。</p>\n<h1 id=\"どんな技術スタックで作ったの？\" style=\"position:relative;\"><a href=\"#%E3%81%A9%E3%82%93%E3%81%AA%E6%8A%80%E8%A1%93%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%AE%EF%BC%9F\" aria-label=\"どんな技術スタックで作ったの？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>どんな技術スタックで作ったの？</h1>\n<h2 id=\"言語\" style=\"position:relative;\"><a href=\"#%E8%A8%80%E8%AA%9E\" aria-label=\"言語 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>言語</h2>\n<ul>\n<li>Typescript</li>\n</ul>\n<h2 id=\"ビルド\" style=\"position:relative;\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89\" aria-label=\"ビルド permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルド</h2>\n<ul>\n<li>@zeit/ncc</li>\n</ul>\n<h2 id=\"テスト\" style=\"position:relative;\"><a href=\"#%E3%83%86%E3%82%B9%E3%83%88\" aria-label=\"テスト permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>テスト</h2>\n<ul>\n<li>jest</li>\n</ul>\n<h2 id=\"lint\" style=\"position:relative;\"><a href=\"#lint\" aria-label=\"lint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lint</h2>\n<ul>\n<li>prettier</li>\n</ul>\n<h2 id=\"その他必要だったライブラリ\" style=\"position:relative;\"><a href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E5%BF%85%E8%A6%81%E3%81%A0%E3%81%A3%E3%81%9F%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA\" aria-label=\"その他必要だったライブラリ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>その他必要だったライブラリ</h2>\n<ul>\n<li>chalk (出力に色つける)</li>\n<li>strip-ansi (出力から色を消す)</li>\n<li>clipboardy (クリップボードから取得)</li>\n</ul>\n<p>みたいな構成で作りました。</p>\n<p>ビルドツールの <code class=\"language-text\">@zeit/ncc</code> だけ見慣れないやつだと思うんですが、「こまかいものを作るのに、Webpackで色々と設定とかめんどくさいな…」と思ったので、<a href=\"https://future-architect.github.io/articles/20200319/\">今あえてTypeScriptのビルド＆バンドルツールを探してみる</a>という記事を参考に、パッと使えそうなやつを選びました。</p>\n<p>たぶんWebpackでわちゃわちゃするより楽なはず…？</p>\n<p>でもこのくらいの小ささなら、どのみち変わらないような…？？</p>\n<p>まぁとにかく <code class=\"language-text\">npx ncc run index.ts</code> で動かしながら開発がやりやすかったから問題なしです。</p>\n<h1 id=\"json-parser-のロジックはどんな感じ？\" style=\"position:relative;\"><a href=\"#json-parser-%E3%81%AE%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AF%E3%81%A9%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98%EF%BC%9F\" aria-label=\"json parser のロジックはどんな感じ？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Json Parser のロジックはどんな感じ？</h1>\n<p>３時間くらい考えて、まっっったく手も足も出なかったので答えを見ました。</p>\n<p>自分が答えに選んだのはこちら。</p>\n<p><a href=\"https://github.com/eatonphil/pj\">https://github.com/eatonphil/pj</a></p>\n<p><a href=\"https://notes.eatonphil.com/writing-a-simple-json-parser.html\">ブログ記事</a> で解説されてるのを、ホーホー言いながら、Typescriptで書き写しつつ、自分なりに書きやすいように修正した感じです。</p>\n<p>一応、自分の実装を解説します。（実装はこちら: <a href=\"https://github.com/kon-shou/fcj\">https://github.com/kon-shou/fcj</a> ）</p>\n<p>下記の Json を </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><span class=\"token property\">\"key1\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"key2\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"aaa\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>下記の Javascript のオブジェクトに変換することを目的とします。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"key1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"key2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"aaa\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>その変換のロジックは２つに分けることが出来ます。</p>\n<ol>\n<li>Jsonをトークンに分解する</li>\n<li>トークンをプログラミング言語のオブジェクトに変換する</li>\n</ol>\n<p>です。 </p>\n<h2 id=\"1-jsonをトークンに分解する\" style=\"position:relative;\"><a href=\"#1-json%E3%82%92%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AB%E5%88%86%E8%A7%A3%E3%81%99%E3%82%8B\" aria-label=\"1 jsonをトークンに分解する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Jsonをトークンに分解する</h2>\n<p>下記の Json を </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><span class=\"token property\">\"key1\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span><span class=\"token property\">\"key2\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"aaa\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>下記のトークンという単位に分解します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'{'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'key1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'{'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'key2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'aaa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'}'</span><span class=\"token punctuation\">,</span>    <span class=\"token string\">'}'</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>その起点となるのは、下記の <code class=\"language-text\">lex()</code> という関数です。</p>\n<div class=\"gatsby-code-title\">lexer.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">lex</span><span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> tokens <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> lexFunc <span class=\"token operator\">=</span> <span class=\"token function\">determineTextType</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>token<span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">lexFunc</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token <span class=\"token operator\">!==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            tokens<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        text <span class=\"token operator\">=</span> rest<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> tokens<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>この <code class=\"language-text\">lex()</code> という関数にJsonを渡してやると <code class=\"language-text\">determineTextType()</code> で「Jsonの中で初めにあるトークン」の種類を判別して、そのトークンをJsonから取り出す関数を <code class=\"language-text\">lexFunc</code> に格納します。</p>\n<p><code class=\"language-text\">lexFunc</code> を実行すると、Jsonからトークンを取り出す。そして取り出された後のJsonについて、もう一度、トークンの種類を判別して… というループを実行します。</p>\n<p><code class=\"language-text\">determineTextType()</code> の実装はこんな感じです。</p>\n<div class=\"gatsby-code-title\">lexer.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">determineTextType</span><span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token constant\">JSON_QUOTE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> lexString<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">NUMBER_CHARS</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> lexNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token constant\">TRUE_LEN</span> <span class=\"token operator\">&amp;&amp;</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">TRUE_LEN</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n        <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token constant\">FALSE_LEN</span> <span class=\"token operator\">&amp;&amp;</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">FALSE_LEN</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"false\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> lexBool<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> <span class=\"token constant\">NULL_LEN</span> <span class=\"token operator\">&amp;&amp;</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL_LEN</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> lexNull<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">JSON_WHITESPACE</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> lexWhiteSpace<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">JSON_SYNTAX</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> lexJsonSyntax<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Text contains not supported char: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>text<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>「文字列の１文字目が <code class=\"language-text\">&quot;</code> か」とか「文字列の４文字目までが <code class=\"language-text\">true</code> か」みたいな条件で、文字列に含まれるトークンを判断します。</p>\n<p>そして、判断されたトークンに応じて、適切な関数を返します。</p>\n<p>例えばトークンがstringだった場合には、下記の <code class=\"language-text\">lexString()</code> が返ります。</p>\n<div class=\"gatsby-code-title\">lexer.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">lexString</span><span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> jsonString <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n    text <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// remove first double quote</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> char <span class=\"token keyword\">of</span> text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>char <span class=\"token operator\">===</span> <span class=\"token constant\">JSON_QUOTE</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n                jsonString<span class=\"token punctuation\">,</span>\n                text<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>jsonString<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// remove last double quote</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        jsonString <span class=\"token operator\">+=</span> char<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>この場合には、「文字列の場合には両端は <code class=\"language-text\">&quot;</code> なので、それを削除したうえで、Jsonからトークンを取り出す。」というロジックになります。</p>\n<h2 id=\"2-トークンをプログラミング言語のオブジェクトに変換する\" style=\"position:relative;\"><a href=\"#2-%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B\" aria-label=\"2 トークンをプログラミング言語のオブジェクトに変換する permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. トークンをプログラミング言語のオブジェクトに変換する</h2>\n<p><code class=\"language-text\">lex()</code> によって分解された下記のトークンを</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'{'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'key1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'{'</span><span class=\"token punctuation\">,</span>   <span class=\"token string\">'key2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">':'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'aaa'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'}'</span><span class=\"token punctuation\">,</span>    <span class=\"token string\">'}'</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>下記のjavascriptのオブジェクトに変換します。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"key1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"key2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"aaa\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>そのために、下記の <code class=\"language-text\">parse()</code> という関数を実行します。</p>\n<div class=\"gatsby-code-title\">parser.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>tokens<span class=\"token operator\">:</span> tokenArray<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">,</span> tokenArray<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token constant\">JSON_LEFTBRACE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token constant\">JSON_LEFTBRACKET</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">parseArray</span><span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>tokens<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tokens<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>「トークンが <code class=\"language-text\">{</code> なら、以降のトークンはオブジェクトの中身のはず、 <code class=\"language-text\">[</code> なら配列の中身のはず。」という前提で、残りのトークンを <code class=\"language-text\">parseObject()</code> / <code class=\"language-text\">parseArray()</code> に渡します。</p>\n<p><code class=\"language-text\">parseObject()</code> の実装は下記のようになります。</p>\n<div class=\"gatsby-code-title\">parser.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">parseObject</span><span class=\"token punctuation\">(</span>tokens<span class=\"token operator\">:</span> tokenArray<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> tokenArray<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> jsonObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token constant\">JSON_RIGHTBRACE</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>jsonObject<span class=\"token punctuation\">,</span> tokens<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> jsonKey <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> jsonKey <span class=\"token operator\">!==</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n                <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Expected string key, got: [</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">typeof</span> jsonKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">] </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>jsonKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> colon <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>colon <span class=\"token operator\">!==</span> <span class=\"token constant\">JSON_COLON</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n                <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Expected colon after key in object, got: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>jsonKey<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        tokens <span class=\"token operator\">=</span> rest<span class=\"token punctuation\">;</span>\n        jsonObject<span class=\"token punctuation\">[</span>jsonKey<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> rightBraceOrComma <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>rightBraceOrComma<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token constant\">JSON_COMMA</span><span class=\"token operator\">:</span>\n                <span class=\"token comment\">// do next loop</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> <span class=\"token constant\">JSON_RIGHTBRACE</span><span class=\"token operator\">:</span>\n                <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>jsonObject<span class=\"token punctuation\">,</span> tokens<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Expected right brace or colon after node in object, got: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>rightBraceOrComma<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>「 <code class=\"language-text\">}</code> ならパースを完了して、空のオブジェクトをreturn、 <code class=\"language-text\">{</code> の次のトークンはキーとなるstringのはず、その次は <code class=\"language-text\">:</code> のはず、その後のトークンはJsonとして何でもあり得るので、再帰的に <code class=\"language-text\">parse()</code> を実行」という流れです。</p>\n<p>そして <code class=\"language-text\">parse()</code> が終わった後は、「次のトークンは <code class=\"language-text\">,</code> か <code class=\"language-text\">}</code> のはず。 <code class=\"language-text\">,</code> ならもう一度最初からオブジェクトのパースを行い、 <code class=\"language-text\">}</code> なら完了して、パース結果をreturn。」という感じで、トークンのパースが終わります。</p>\n<p>これをトークンが <code class=\"language-text\">[</code> で始まった場合では <code class=\"language-text\">parseArray()</code> で同様にパースを実行し、結果Javascriptのオブジェクトができあがるという訳です。</p>\n<h1 id=\"json-parser-のロジックをカンニングして実装した感想\" style=\"position:relative;\"><a href=\"#json-parser-%E3%81%AE%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%82%92%E3%82%AB%E3%83%B3%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%9F%E6%84%9F%E6%83%B3\" aria-label=\"json parser のロジックをカンニングして実装した感想 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Json Parser のロジックをカンニングして実装した感想</h1>\n<p>出来上がったものについて、あーだこーだ言うことはできるのですが、０からハイ作って！と言われると難しいですね…！</p>\n<p>いつか０からバーっと書けるように、この手の構文解析（？）的なやつをコツコツやっていこうと思います。</p>\n<h1 id=\"（おまけ）テストについて\" style=\"position:relative;\"><a href=\"#%EF%BC%88%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%89%E3%83%86%E3%82%B9%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\" aria-label=\"（おまけ）テストについて permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>（おまけ）テストについて</h1>\n<p>初めてカバレッジに触れたのですが、これ良いですね。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 787px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e1f9bf18371997654855735163e37b1b/e619b/test_screen.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABdUlEQVQoz5VOy04cMRBsv9p2254nOzuz7EMg2EsUBZhdtERBROJOpOQfcuP1A4hbfjs9u0CUnEKpZJfKVd2Gn5ef7y/WdwNXt8zNahCb/uFy8/T95vnHt8frK3a25svr3Wb1ePXl19dz+IjuDOAUoAfRg+yF6IVkvdJmnbJ1TGuKL46QTNYcPgH4BAA2j+ANKCWcwyLTKWKebJVLCiYGHcikwI6K7OcmcSCBVrBDNcWiQxekUbrax2rinNfjY55kYq3rzhdjOz4IAILDckvxSshanHyg1GitNBV6dOClUA2XCUPN4zySao+CNQpRwj/IO5ydhGpuldLlPtYzL5UazS1xq9LlxFNpRofUETbBwG7hG2JtmiM3bJbGeFVNHX+t6KwP1me6aBx6XU9p+K8AscWfshvgLVqXlM+UMUhEnJBSvp3beyf+Li+Xy7btvHOTZdYeR6JQlqWA/8NisSirwjrc22vIBXgX5rO5tsKS5uVSyXd1fwMqxCUknW0I5wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test_screen.png\"\n        title=\"test_screen.png\"\n        src=\"/static/e1f9bf18371997654855735163e37b1b/e619b/test_screen.png\"\n        srcset=\"/static/e1f9bf18371997654855735163e37b1b/8ff5a/test_screen.png 240w,\n/static/e1f9bf18371997654855735163e37b1b/e85cb/test_screen.png 480w,\n/static/e1f9bf18371997654855735163e37b1b/e619b/test_screen.png 787w\"\n        sizes=\"(max-width: 787px) 100vw, 787px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>ザーッとテスト書いて、カバレッジ足りない所を足したり、カバレッジ足りてるのに再度テストしてるのを消したり、テスト書いててで割と辛い「テストケースに網羅性をもたせる」というのがやりやすくなりました。　</p>\n<p>ただ「カバレッジ100%を目指すと辛い」というのも実感しましたね…。</p>\n<p>というのも、今回だと Json Parser 以外のファイル保存周りをテストしようしたら、「fsモジュールのモック」とか「自分で作ったモジュールでexportされてないsave系のメソッドをモック」をしなくちゃいけなかったりで、大変でした。</p>\n<p>大変さの割に、確認できることは「fs モジュールがただしく動作すること」だったりで、「なるほど、これが噂の100%を目指すと辛いというやつか…」と思いました。</p>\n<p>ただその辛さも全体の5%くらいで、95%くらいはメリットの方が上回りそう。</p>\n<p>副作用が絡むような難しいところは無視しつつ「テストし忘れのロジック」を発見するためにカバレッジを利用するのが良いんでしょうね。</p>","fields":{"slug":"/posts/20200816/","tagSlugs":["/tag/アルゴリズム/","/tag/typescript/","/tag/npm/"]},"frontmatter":{"date":"2020-08-16","tags":["アルゴリズム","Typescript","npm"],"title":"クリップボードから Json を読み込んで、整形してターミナルに表示するコマンドを作った","description":"Json Paser を npm パッケージ として作成しました。","image":null}}},"pageContext":{"slug":"/posts/20200816/"}},"staticQueryHashes":["1155056556","1525128060","783282510"]}